require "autotest/fsevent"
require "autotest/growl"

Autotest::Growl::clear_terminal = false
Autotest::Growl::show_modified_files = false

Autotest.add_hook :initialize do |at|
  at.clear_mappings

  %w{.git .svn .hg .DS_Store ._* vendor tmp log doc}.each do |exception|
    at.add_exception(exception)
  end

  # If a lib source file changes, run tests that have the source name
  at.add_mapping(/^lib\/.*\.rb$/) do |filename, _|
    possible = File.basename(filename)[0..-4].gsub '_', '_?'
    at.files_matching %r|^test.*/.*#{possible}_test\.rb$|
  end

  # If test helper changes, run all tests
  at.add_mapping(/^test.*\/test_helper\.rb$/) do |filename, _|
    at.files_matching %r|^test.*/.*_test\.rb$|
  end

  # If a test changes, run the test
  at.add_mapping(/^test.*\/.*_test\.rb$/) do |filename, _|
    filename
  end
end
