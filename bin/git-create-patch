#!/usr/bin/env bash

echo_and_eval() {
  cmd="$@"
  echo -e "$cmd\n"
  eval $cmd
}

if [[ "$#" -lt 2 ]]; then
    cat <<END
Usage: $0 <subject-prefix> <rev-comp> [options...]

  Where
    <subject-prefif> is the prefix for patch subject

    <rev-comp> is the commit against which to compare the commits in the patch
    (such as "master", "next", or "develop")

    [options] are options to git format-patch
END
    exit 1
fi

subject_prefix="$1"
rev_comp="$2"
shift 2

echo_and_eval "rm -f 00??-*.patch"
echo_and_eval "git format-patch -M -n --no-binary --subject-prefix=\"$subject_prefix\" "$@" \"$rev_comp\""
