#!/usr/bin/env bash

BUNDLE_DIR="/Library/Application Support/TextMate/Bundles"

error_exit()
{
    echo "$@"
    exit 1
}

cd "$BUNDLE_DIR" || error_exit 'cannot access system bundle directory'

for bundle in *.tmbundle; do
    echo -n "${bundle}... "
    cd "${BUNDLE_DIR}/${bundle}" || error_exit "cannot access ${bundle}"
    if [[ -d '.git' ]]; then
        echo 'git pull'
        git pull
    elif [[ -d '.svn' ]]; then
        echo 'svn update'
        svn update
    else
        echo 'unknown or no VCS, skipping'
    fi
    echo
done

osascript -e 'tell app "TextMate" to reload bundles'
